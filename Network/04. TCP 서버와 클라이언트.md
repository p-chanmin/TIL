# TCP 서버와 클라이언트



## TCP와 UDP에 대한 이해



### 프로토콜 계층

* TCP/IP 프로토콜 스택

  네트워크 관련 프로토콜을 계층으로 분류하여 계층별 프로토콜 개발 및 유지관리 등 표준화 효율성 확대

  개방형 시스템



* 인터넷 계층 모델

  4계층 - 응용 계층

  3계층 - 전송 계층

  2계층 - 데이터 링크 계층

  1계층 - 물리 계층

  

* OSI 7 계층 모델

  7계층 - 응용 계층

  6계층 - 프리젠테이션 계층

  5계층 - 세션 계층

  4계층 - 전송 계층

  3계층 - 네트워크 계층

  2계층 - 데이터 링크 계층

  1계층 - 물리 계층

---

* 물리 계층
  * 물리적 특성에 대한 정의
  * 케이블 및 커넥터, 전기 규격, 신호 방식 등 정의
  * 관련 장비 - 허브, 리피트
* 데이터 링크 계층
  * 링크 간 데이터 전송 제어와 관련 내용을 정의
  * 다양한 MAC 프로토콜, CSMA/CD 등
  * 관련 장비 - 스위치
* 네트워크 계층
  * 네트워크 상에서 경로를 관리하고 최선의 경로를 선택하여 패킷을 목적지까지 전달
  * IP 프로토콜 등
  * 관련 장비 - 라우터
* 전송 계층
  * 다양한 전송 서비스 제공
  * TCP, UDP 등
  * 신뢰성 있는 데이터 전송 개념 ( 재전송 메커니즘 사용 : selective repeat )
* 응용 계층
  * 네트워크 프로토콜들의 전송 서비스를 기반으로 다양한 네트워크 기반의 응용 네트워크 서비스 개발 및 정의
  * FTP, Telnet, HTTP, SMTP, SNMP, DNS 등



## TCP기반 서버, 클라이언트 구현

![캡처](https://user-images.githubusercontent.com/87304360/164896440-dd0221a5-a92b-422c-9c77-54aeb8bae4c6.PNG)

* **listen() 함수**
  * listen() 함수 호출을 통해 TCP로 하여금 LISTEN 상태로 천이
  * 클라이언트로 하여금 TCP 연결 요청을 수신할 준비 상태가 됨
  * listen( SOCKET s, int backlog ); 
  * listen() 함수의 두 번째 파라메터인 backlog  값은 클라이언트 수신 연결 요청이 저장될 대기 큐의 크기를 설정
* **accept() 함수**
  * listen() 함수의 첫 번째 파라메터는 클라이언트로부터 연결 요청을 대기하기 위한 소켓에 해당함
  * accept() 함수의 반환 소켓은 클라이언트와 연결을 통해 데이터 송,수신을 위한 소켓에 해당
  * SOCKET accept( SOCKET s, struct sockaddr *addr, int *addrlen);
* **connect() 함수**
  * connect() 함수에 연결할 서버 주소를 설정하고, 해당 서버와 TCP 연결 설정을 요청
  * connect( SOCKET s, struct sockaddr *addr, int addrlen);



## Iterative TCP 연결 방식 구현

* 반복적 (Iterative) TCP 연결 방식
  * 서버가 연결된 클라이언트와 통신 종료 후 대기 중인 다음 클라이언트와 반복해서 통신 진행하는 방식
* 반복적 TCP 연결 방식
  * 반복문을 통해 accept() 함수 호출
  * 한 순간에 하나의 클라이언트와 연결되어 통신함
* 반복적 TCP 연결 방식의 문제점
  * 서버는 하나의 클라이언트와 연결되어 서비스를 제공하므로 다른 클라이언트들은 연결 대기해야함
  * 현재 연결된 클라이언트가 통신이 활발하지 않더라도 연결이 종료될 때까지 기다려야 함
  * 쓰레드를 적용해서 여러 클라이언트들을 동시에 서비스하도록 개선 필요



## 응용 계층 프로토콜

* TCP 서버와 클라이언트 간에 동작에 필요한 패킷(메시지)을 정의
* 상호 간에 전송에 관한 약속이 필요
* 이를 응용 계층 프로토콜 또는 애플리케이션 프로토 콜이라고 함
* 애플리케이션 프로토콜
  * 메시지의 종류
  * 각 메시지의 구조
  * 각 메시지의 송수신 타이밍
  * 메시지를 수신했을 때의 동작



## TCP기반 전송 방식 이해

* 연결 설정(connection establishment)
  * 상대방의 수신 버퍼 크기와 데이터의 순서 번호 정보 획득
  * 수신 버퍼량을 고려해서 송신량 조절
  * 순서 번호에 맞게 데이터가 도달하는 지를 확인하여 데이터 손실 확인
* 연결을 통한 데이터 송수신
* 연결 종료(connection close)
  * 연결 종료 요청한 편에서 상대로 부터 FIN 패킷 수신 후 대기 상태로 진입하여 ACK 손실 에 따른 FIN 재전송 대기