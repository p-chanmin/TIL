# 컴퓨터 시스템 개요



## 운영체제의 정의

* 시스템 관점에서 운영체제 : 자원관리자
  - 물리적자원과 추상적자원의 효율적인 관리



## 컴퓨터의 구성 요소(하드웨어)

* 처리기 (중앙 처리 장치 : CPU)
  - 컴퓨터의 두뇌 : 데이터 연산, 논리 연산(ALU), 제어
  - 레지스터
* 주기억장치 (main memory) : 휘발성
  - 메모리 셀 : 메모리 내의 개별적인 저장공간
  - 데이터와 프로그램 저장 ( 실 메모리 )
* 저장 장치 (storage device) : 비휘발성
* 입출력 장치
* 통신 장치



## 처리기 레지스터

* 레지스터
  * 메모리 주소 레지스터 (MAR)
    - 다음번에 읽거나 쓸 주소 명시
  * 메모리 버퍼 레지스터 (MBR)
    - 메모리에 쓸 데이터나 메모리로부터 수신된 데이터를 포함
  * I/O 주소 레지스터 (I/O AR)
  * I/O 버퍼 레지스터 (I/O BR)



## 마이크로 프로세서의 발전

* 마이크로 프로세서
  - 단일 칩에 하나의 프로세서를 집적
  - 가장 빠른 범용 프로세서
  - 멀티 프로레서로 발전 - 하나의 칩에 코어라고 불리는 여러개의 프로세서 포함
* GPU
  - 단일 명령 다중데이터 처리
  - 고급 그래픽 렌더링 뿐만 아니라 범용 수치처리에도 사용
* DSP
  - 오디오와 비디오 같은 스트림형 시그널 처리를 위한 프로세서
* SoC
  - CPU와 캐시 뿐 아니라 DSP, GPU, I.O 디바이스, 주기억장치 등이 하나의 칩에 내장



## 주요 처리기 레지스터

* 제어 및 상태 레지스터
  - 처리기의 작동을 제어하기 위해 사용
  - 프로그램의 실행을 제어하기 위한 특권 모드의 운영체제 루틴에 의해 사용됨
  - 프로그램 계수기 (PC)
    - 반입할 명령어의 주소 포함
  - 명령어 레지스터 (IR)
    - 최근에 반입된 명령어 포함
  - 프로그램 상태 워드 (PSW)
    - 인터럽트 가능화/불능화
    - 슈퍼바이저/사용자모드
    - 조건 코드 or 플래그



## 명령어 실행

* 명령어 실행 2단계
  - 처리기가 메모리로부터 명령어 읽음 (반입 단계)
  - 처리기가 각 명령어 실행 (수행 단계)



## 인터럽트

* 인터럽트는 처리기의 정상적인 흐름을 방해

* 대부분의 I/O 디바이스는 처리기보다 느림

  - 처리기는 디바이스가 작업을 완료 할 때까지 기다려야 함
  - 처리기의 성능 저하 유발
  - Blocking I/O의 문제점

* 이를 위하여 디바이스가 작업이 완료되면 처리기에 인터럽트를 걸 수 있도록 허용

* 인터럽트 부류

  | 프로그램      | 산술연산 오버플로, 0으로 나누기, 불법척인 기계 명령어 수행 시도, 사용자에게 허용된 메모리 공간 밖의 참조 등과 같은 명령어 수행 결과로 발생하는 어떤 조건에 의해 생성 |
  | ------------- | ------------------------------------------------------------ |
  | 타이머        | 처리기 내의 타이머에 의해 생성된다. 이것은 운영체제로 하여금 특정 기능을 정규적으로 수행할 수 있도록 허용한다. |
  | 입출력        | 입출력 제어기에 의해 생성되며, 연산의 정산적인 종료를 알리거나 다양한 에러 조건을 알려준다. |
  | 하드웨어 실패 | 전원 결함 또는 메모리 패리티 에러와 같은 결함에 의해 생성    |



## 인터럽트 단계

* 처리기가 인터럽트를 검사
* 인터럽트가 발생한 경우
  - 프로그램의 실행을 보류
  - 인터럽트-처리 루틴 실행
* 인터럽트 처리 루틴
  - 특정 I/O 디바이스를 서비스하기 위한 프로그램
  - 일반적으로 운영체제 시스템에 포함됨
  - 인터럽트 처리를 위한 오버헤드가 존재하나, 입출력 연산이 완료되기를 기다리며 낭비하는 시간에 비해 상대적으로 짧다.



## 순차적 인터럽트

* 하나의 인터럽트가 처리 중에는 다른 인터럽트를 불능화
  - 상대적인 우선 순위나 시간 긴급도를 고려하지 않음



## 다중 인터럽트

* 인터럽트 간의 우선순위 지정



## 메모리 계층 구조

- 접근 시간이 빠르면 비트 당 비용이 높아짐
- 용량이 크면 비트 당 저장 비용이 낮아지고 접근 시간이 길어짐



## 2차 메모리

- 보조 메모리
- 외부 저장 장치
- 비휘발성이며 프로그램과 데이터 파일을 저장하기 위해 사용



## 캐시 메모리

- 캐싱
  - 빠른 저장 장치에 정보를 복사해 놓는 기법
  - 고속의 메모리에 최근에 접근한 데이터를 저장
  - 캐시 관리 정책이 필요함
  - 캐싱은 메모리 계층 구조에 또 다른 레벨을 도입하는데, 하나 이상의 레벨에 동시에 저장된 데이터 사이에 내용이 일치 해야 함.



- 캐시 원칙
  - 주 메모리의 한 영역의 복사본을 가지고 있음
  - 처리기는 먼저 캐시를 참조
  - 캐시에 없으면, 필요한 정보가 저장된 메모리 블록이 캐시로 읽혀짐
  - 참조 지역성 때문에 향후 참조될 데이터는 캐시에 존재할 가능성이 높음



- 캐시 메모리

  - 운영체제에게 보이지 않고 하드웨어적으로 처리됨
  - 메모리 접근 속도를 향상시킴
  - 프로세서의 속도는 메모리의 속도보다 빠름
  - 참조 지역성의 원리를 이용

  

- 디스크 캐시

  - 메인 메모리의 일부가 디스크에 저장된 데이터의 일부를 일시적으로 저장하기 위해서 사용됨
  - 디스크 쓰기는 클러스터되는 경햐야이 있음
  - 어떤 데이터들은 또 접근될 수 있는데, 이 경우 디스크가 아닌 버퍼 캐시로 부터 데이터를 읽어오므로 접근 속도가 빠름



- 참조 지역성

  - 프로그램이 실행되는 도중에 처리기에 의해서 접근되는 메모리 영역이 집중화하는 경향이 있음

  - 장기적으로 이러한 클러스터는 변경될 수 있으나, 짧은 시간에 처리기는 메모리 접근을 고정된 수의 클러스트에 한정되는 경향이 있음

  - 명령어 : 반복문, 서브루틴

  - 데이터 : 테이블, 배열

  - 적중률

    - 메모리 접근 중 데이터가 빠른 메모리(캐시 메모리)에 존재할 비율로 정의

    - T1 은 캐시 메모리 접근 시간 : 0.1us

    - T2 는 메인 메모리 접근 시간 : 1us

    - 메모리 접근 중 95%가 캐시에서 데이터를 찾는 경우 : Hit ratio H = 0.95

    - 평균 메모리 접근 시간

      (0.95)(0.01us) + (0.05)(1us + 0.1us) = 0.095 + 0.055 = 0.15us



- 캐시의 크기

  - 작은 크기의 캐시도 성능에 큰 영향을 미침

- 블록의 크기

  - 캐시와 메인 메모리 사이에 교환되는 데이터의 단위

  - 블록의 크기가 클수록 높은 적중률

    단, 새로 반입된 데이터를 참조할 확률이 캐시에서 방출된 데이터를 참조할 확률보다 적어질 때 까지

- 매핑함수

  - 블록이 캐시의 어느 위치에 저장될 지를 결정

- 교체 알고리즘

  - 교체될 블록을 선정
  - LRU 알고리즘

* 쓰기 정책
  - 어느 시점에 메모리로 쓸 것인가를 결정
  - 블록이 갱신될 때마다 씀
  - 블록이 교체될 때마다 씀
    - 쓰기 연산을 최소로 함
    - 메인 메모리의 데이터가 최신이 아님



## 입출력 통신 기술

* 프로그램된 입출력
  - 처리기는 I/O 연산이 끝날 때까지 I/O 모듈의 상태를 주기적으로 체크
  - 처리기가 아니라 입출력 모듈이 수행
  - 입출력 상태 레지스터에 적절한 비트를 저장
  - 인터럽트 없음
  - 처리기는 연산이 완료될 때까지 상태 검사
* 인터럽트 구동 입출력
  - I/O 모듈이 데이터를 교환할 준비가 되면 처리기에게 인터럽트를 보냄
  - 처리기는 프로그램의 실행 문맥을 저장하고, 인터럽트 처리 루틴을 실행
  - 기다릴 필요가 없음
  - 읽거나 쓸 데이터가 처리기를 통해서 이동되기 때문에 처리기 시간을 낭비
* 직접 메모리 접근(DMA)
  - 디바이스 제어기는 처리기의 간섭 없이 주기억장치와 I/O 모듈의 버퍼 사이에 데이터 블록을 직접 전송
  - 디바이스 제어기는 "메모리 사이클 훔침" 기법을 이용하여 메인 메모리와 I/O 모듈 상이에 데이터를 직접 전송
  - 처리기는 명령어를 실행하는데 전혀 지장을 받지 않음
  - DMA 모듈은 데이터 전송을 위해 I/O 제어기를 이용, 작업이 끝나면 인터럽트를 통해 알림
  - 많은 양의 I/O 연산을 수행하는 시스템의 I/O 성능을 높여줌



## 하드웨어 보호

* 이중 모드 연산
  - 시스템 자원을 공유하기 위해서 운영체제는 부정확한 프로그램이 다른 프로그램의 수행을 부정확하게 만들지 않도록 보장
  - 연산의 모드를 구분해주는 하드웨어의 지원 ( 사용자 모드, 시스템 모드 )
  - 인터럽트가 발생하거나 장애가 발생하면 하드웨어는 시스템 모드로 모드를 전환
  - 특권 명령어(privileged instructions)는 시스템 모드에서만 수행할 수 있음
* I/O 보호
  - 모든 I/O 명령은 특권 명령
  - I/O 명령을 수행하기 위해서는 운영체제의 서비스를 받아야 하며, 운영체제는 시스템 모드에서 I/O 작업을 수행
* 메모리 보호
  - 프로그램이 다른 프로그램 영역을 침범하지 않도록 보호 돼야 하며, 특히 운영체제의 영역은 반드시 보호되야 함
  - 메모리 접근이 적법한지를 판단하여 메모리 보호를 하기 위하여 보통 2개의 레지스터 사용
    - 베이스 레지스터(Base register) – 물리 메모리의 시작 주소를 저장
    - 경계(Limit register) – 메모리에 올라가 있는 프로그램의 크기를 저장
* CPU 보호
  - 타이머(Timer) – 특정 시간이 지나면 운영체제가 수행될 수 있도록 인터럽트를 검
  - 타이머는 시분할 시스템을 구현하기 위해서도 사용됨
  - 타이머는 현재 시간을 계산하기 위해서도 사용됨
  - 타이머 값을 초기화 시키는 Load-timer 명령어는 특권 명령어

